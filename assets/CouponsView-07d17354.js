import{P as M,M as _}from"./PaginationModal-01ca08ca.js";import{_ as C,o as d,c as i,b as t,g as p,v as r,N as k,e as v,t as c,a as x,L as D,F as V,y as L,d as b,r as f}from"./index-a0ce355d.js";const N={props:{tempCoupons:{type:Object,default(){return{}},required:!0},isNew:{type:Boolean,default:!1}},data(){return{tempCoupon:{},due_date:""}},watch:{tempCoupons(){this.tempCoupon=this.tempCoupons;const o=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=o},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},P={class:"modal-dialog modal-xl"},T={class:"modal-content border-0"},B={class:"modal-header bg-dark text-white"},E={id:"couponsModalLabel",class:"modal-title"},U={key:0},A={key:1},I=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),S={class:"modal-body"},O={class:"mb-3"},q=t("label",{for:"title",class:"form-label"},"優惠券名稱",-1),j={class:"mb-3"},F=t("label",{for:"code",class:"form-label"},"優惠券碼",-1),H={class:"mb-3"},R=t("label",{for:"discount",class:"form-label"},"折扣百分比",-1),z={class:"mb-3"},G=t("label",{for:"due_date"},"到期日",-1),J={class:"mt-3"},K={class:"form-check d-flex justify-content-end"},Q=t("label",{class:"form-check-label px-3",for:"is_enabled"},"是否啟用",-1),W={class:"modal-footer"},X=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Y(o,e,a,g,s,u){return d(),i("div",P,[t("div",T,[t("div",B,[t("h5",E,[a.isNew?(d(),i("span",U,"新增優惠券")):(d(),i("span",A,"編輯優惠券"))]),I]),t("div",S,[t("div",O,[q,p(t("input",{id:"title","onUpdate:modelValue":e[0]||(e[0]=n=>s.tempCoupon.title=n),type:"text",class:"form-control",placeholder:"請輸入優惠券名稱"},null,512),[[r,s.tempCoupon.title,void 0,{trim:!0}]])]),t("div",j,[F,p(t("input",{id:"code","onUpdate:modelValue":e[1]||(e[1]=n=>s.tempCoupon.code=n),type:"text",class:"form-control",placeholder:"請輸入優惠券碼",oninput:"value=value.replace('-', '')"},null,512),[[r,s.tempCoupon.code,void 0,{trim:!0}]])]),t("div",H,[R,p(t("input",{id:"discount","onUpdate:modelValue":e[2]||(e[2]=n=>s.tempCoupon.percent=n),type:"number",class:"form-control",min:"0",max:"100",placeholder:"請輸入折扣百分比",oninput:"value=value.replace('-', '')"},null,512),[[r,s.tempCoupon.percent,void 0,{number:!0}]])]),t("div",z,[G,p(t("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[3]||(e[3]=n=>s.due_date=n)},null,512),[[r,s.due_date]])]),t("div",J,[t("div",K,[p(t("input",{id:"is_enabled","onUpdate:modelValue":e[4]||(e[4]=n=>s.tempCoupon.is_enabled=n),class:"form-check-input",type:"checkbox","true-value":1,"false-value":0},null,512),[[k,s.tempCoupon.is_enabled]]),Q])])]),t("div",W,[X,t("button",{type:"button",class:"btn btn-custom_medium-green text-white",onClick:e[5]||(e[5]=n=>o.$emit("updateCoupons",this.$props.isNew))}," 確認 ")])])])}const Z=C(N,[["render",Y]]),tt={props:{tempCoupons:{type:Object,default(){return{}},required:!0}}},et={class:"modal-dialog"},ot={class:"modal-content border-0"},st=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delCouponsModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),nt={class:"modal-body"},at={class:"text-danger"},lt={class:"modal-footer"},dt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function it(o,e,a,g,s,u){return d(),i("div",et,[t("div",ot,[st,t("div",nt,[v(" 是否刪除 "),t("strong",at,c(this.$props.tempCoupons.title),1),v(" 優惠券(刪除後將無法恢復)。 ")]),t("div",lt,[dt,t("button",{type:"button",class:"btn btn-danger",onClick:e[0]||(e[0]=n=>o.$emit("delCoupons"))},"確認刪除")])])])}const ut=C(tt,[["render",it]]),{VITE_API:m,VITE_PATH:h}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"qoqvuedemo",BASE_URL:"/Vite_week6/",MODE:"production",DEV:!1,PROD:!0},pt={name:"CouponView",props:["token"],data(){return{coupons:[],tempCoupons:{},isNew:!1,page:{}}},components:{Pagination:M,MealModal:Z,DelmealModal:ut},methods:{...x(D,["showLoading","hideLoading"]),getData(o=1){const e=`${m}api/${h}/admin/coupons?page=${o}`;this.$http.get(e).then(a=>{this.coupons=a.data.coupons,this.page=a.data.pagination,this.hideLoading()}).catch(a=>{alert(a.response.data.message),this.hideLoading()})},openModal(o,e){o==="new"?(this.tempCoupons={due_date:new Date().getTime()/1e3,is_enabled:0},this.isNew=!0,this.modal=new _(this.$refs.couponsModal,{keyboard:!0,backdrop:"true"}),this.modal.show()):o==="edit"?(this.tempCoupons={...e},this.isNew=!1,this.modal=new _(this.$refs.couponsModal,{keyboard:!0,backdrop:"true"}),this.modal.show()):o==="delete"&&(this.tempCoupons={...e},this.modal=new _(this.$refs.delCouponsModal,{keyboard:!0,backdrop:"true"}),this.modal.show())},updateCoupons(){let o=`${m}api/${h}/admin/coupon`,e="post";this.isNew||(o=`${m}api/${h}/admin/coupon/${this.tempCoupons.id}`,e="put"),this.$http[e](o,{data:this.tempCoupons}).then(()=>{this.isNew?this.$swal.fire({toast:!0,position:"top-end",icon:"success",title:"新建一個新優惠券成功",showConfirmButton:!1,timer:1500}):this.$swal.fire({toast:!0,position:"top-end",icon:"success",title:"修改優惠券成功",showConfirmButton:!1,timer:1500}),this.modal.hide(),this.getData()}).catch(a=>{alert(a.response.data.message)})},delCoupons(){const o=`${m}api/${h}/admin/coupon/${this.tempCoupons.id}`;this.$http.delete(o).then(()=>{this.$swal.fire({toast:!0,position:"top-end",icon:"success",title:"刪除優惠券成功",showConfirmButton:!1,timer:1500}),this.modal.hide(),this.getData()}).catch(e=>{alert(e.data.message)})}},mounted(){this.getData()}},ct={class:"container-fluid"},rt={class:"text-end mt-4 me-5"},mt={class:"table mt-4"},ht=t("thead",null,[t("tr",null,[t("th",null,"優惠券名稱"),t("th",null,"優惠卷碼"),t("th",null,"折扣百分比"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",{class:"text-center"},"編輯")])],-1),_t={key:0,class:"text-success"},bt={key:1,class:"text-danger"},ft={class:"text-center"},Ct={class:"btn-group"},gt=["onClick"],vt=["onClick"],$t={id:"couponsModal",ref:"couponsModal",class:"modal fade",tabindex:"-1","aria-labelledby":"couponsModalLabel","aria-hidden":"true"},wt={id:"delCouponsModal",ref:"delCouponsModal",class:"modal fade",tabindex:"-1","aria-labelledby":"delCouponsModalLabel","aria-hidden":"true"};function yt(o,e,a,g,s,u){const n=f("Pagination"),$=f("MealModal"),w=f("DelmealModal");return d(),i("div",ct,[t("div",rt,[t("button",{type:"button",class:"btn btn-custom_btn-color text-white",onClick:e[0]||(e[0]=l=>u.openModal("new"))}," 增加新優惠券 ")]),t("table",mt,[ht,t("tbody",null,[(d(!0),i(V,null,L(s.coupons,l=>(d(),i("tr",{key:l.id},[t("td",null,c(l.title),1),t("td",null,c(l.code),1),t("td",null,c(l.percent)+" %",1),t("td",null,c(new Date(l.due_date*1e3).toLocaleDateString()),1),t("td",null,[l.is_enabled?(d(),i("span",_t,"已啟用")):(d(),i("span",bt,"未啟用"))]),t("td",ft,[t("div",Ct,[t("button",{type:"button",class:"btn btn-sm btn-outline-custom_dark-green",onClick:y=>u.openModal("edit",l)}," 編輯 ",8,gt),t("button",{type:"button",class:"btn btn-sm btn-outline-custom_red ms-md-2",onClick:y=>u.openModal("delete",l)}," 刪除 ",8,vt)])])]))),128))])]),b(n,{pages:s.page,onChangePage:u.getData},null,8,["pages","onChangePage"]),t("div",$t,[b($,{"temp-coupons":s.tempCoupons,"is-new":s.isNew,onUpdateCoupons:u.updateCoupons},null,8,["temp-coupons","is-new","onUpdateCoupons"])],512),t("div",wt,[b(w,{"temp-coupons":s.tempCoupons,onDelCoupons:u.delCoupons},null,8,["temp-coupons","onDelCoupons"])],512)])}const xt=C(pt,[["render",yt]]);export{xt as default};
